# osixia/phpldapadmin

[![](https://badge.imagelayers.io/osixia/phpldapadmin:latest.svg)](https://imagelayers.io/?images=osixia/phpldapadmin:latest 'Get your own badge on imagelayers.io') | Latest release: 0.6.7 - [Changelog](CHANGELOG.md) | [Docker Hub](https://hub.docker.com/r/osixia/phpldapadmin/)Â 

A docker image to run phpLDAPadmin.
> [phpldapadmin.sourceforge.net](http://phpldapadmin.sourceforge.net)

## Quick start

Run a phpLDAPadmin docker image by replacing `ldap.example.com` with your ldap host or IP :

    docker run -p 6443:443 \
           --env PHPLDAPADMIN_LDAP_HOSTS=ldap.example.com \
           --detach osixia/phpldapadmin:0.6.7

That's it :) you can access phpLDAPadmin on [https://localhost:6443](https://localhost:6443)

## Beginner Guide

### OpenLDAP & phpLDAPadmin in 1'

Example script:

    #!/bin/bash -e

    # Run a ldap server, save the container id in LDAP_CID and get its IP:
    LDAP_CID=$(docker run --hostname ldap.example.org --detach osixia/openldap:1.1.0)
    LDAP_IP=$(docker inspect -f "{{ .NetworkSettings.IPAddress }}" $LDAP_CID)

    # Run phpLDAPadmin and set ldap host to ldap ip
    PHPLDAP_CID=$(docker run --hostname phpldapadmin.example.org --env PHPLDAPADMIN_LDAP_HOSTS=$LDAP_IP --detach osixia/phpldapadmin:0.6.7)

    # We get phpLDAPadmin container ip
    PHPLDAP_IP=$(docker inspect -f "{{ .NetworkSettings.IPAddress }}" $PHPLDAP_CID)

    echo "Go to: https://$PHPLDAP_IP"
    echo "Login DN: cn=admin,dc=example,dc=org"
    echo "Password: admin"

### HTTPS

#### Use autogenerated certificate
By default HTTPS is enable, a certificate is created with the container hostname (it can be set by docker run --hostname option eg: phpldapadmin.my-company.com).

	docker run --hostname phpldapadmin.my-compagny.com --detach osixia/phpldapadmin

#### Use your own certificate

You can set your custom certificate at run time, by mouting a directory containing those files to **/container/service/phpldapadmin/assets/apache2/certs** and adjust their name with the following environment variables:

	docker run --volume /path/to/certifates:/container/service/phpldapadmin/assets/apache2/certs \
	--env PHPLDAPADMIN_HTTPS_CRT_FILENAME=my-phpldapadmin.crt \
	--env PHPLDAPADMIN_HTTPS_KEY_FILENAME=my-phpldapadmin.key \
	--env PHPLDAPADMIN_HTTPS_CA_CRT_FILENAME=the-ca.crt \
	--detach osixia/phpldapadmin:0.6.7

Other solutions are available please refer to the [Advanced User Guide](#advanced-user-guide)

#### Disable HTTPS
Add --env PHPLDAPADMIN_HTTPS=false to the run command :

    docker run --env PHPLDAPADMIN_HTTPS=false --detach osixia/phpldapadmin

## Environment Variables

Environment variables defaults are set in **image/environment/default.yaml**

See how to [set your own environment variables](#set-your-own-environment-variables)

- **PHPLDAPADMIN_LDAP_HOSTS**: Set phpLDAPadmin server config. Defaults to :

  ```yaml
  - ldap.example.org:
    - server:
      - tls: true
    - login:
      - bind_id: cn=admin,dc=example,dc=org
  - ldap2.example.org
  - ldap3.example.org
  ```
  This will be converted in the phpldapadmin config.php file to :
  ```php5
  $servers->newServer('ldap_pla');
  $servers->setValue('server','name','ldap.example.org');
  $servers->setValue('server','host','ldap.example.org');
  $servers->setValue('server','tls',true);
  $servers->setValue('login','bind_id','cn=admin,dc=example,dc=org');
  $servers->newServer('ldap_pla');
  $servers->setValue('server','name','ldap2.example.org');
  $servers->setValue('server','host','ldap2.example.org');
  $servers->newServer('ldap_pla');
  $servers->setValue('server','name','ldap3.example.org');
  $servers->setValue('server','host','ldap3.example.org');
  ```
  All server configuration are available, just add the needed entries, for example:  
  ```yaml
  - ldap.example.org:
    - server:
      - tls: true
      - port: 636
      - force_may: array('uidNumber','gidNumber','sambaSID')
    - login:
      - bind_id: cn=admin,dc=example,dc=org
      - bind_pass: p0p!
    - auto_number:
      - min: 1000
  - ldap2.example.org
  - ldap3.example.org
  ```

  See complete list: http://phpldapadmin.sourceforge.net/wiki/index.php/LDAP_server_definitions

  If you want to set this variable at docker run command add the tag `#PYTHON2BASH:` and convert the yaml in python:

		docker run --env PHPLDAPADMIN_LDAP_HOSTS="#PYTHON2BASH:[{'ldap.example.org': [{'server': [{'tls': True}]},{'login': [{'bind_id': 'cn=admin,dc=example,dc=org'}]}]}, 'ldap2.example.org', 'ldap3.example.org']" --detach osixia/phpldapadmin:0.6.7

  To convert yaml to python online: http://yaml-online-parser.appspot.com/

Apache :
- **PHPLDAPADMIN_SERVER_ADMIN**: Server admin email. Defaults to `webmaster@example.org`

HTTPS :
- **PHPLDAPADMIN_HTTPS**: Use apache ssl config. Defaults to `true`
- **PHPLDAPADMIN_HTTPS_CRT_FILENAME**: Apache ssl certificate filename. Defaults to `phpldapadmin.crt`
- **PHPLDAPADMIN_HTTPS_KEY_FILENAME**: Apache ssl certificate private key filename. Defaults to `phpldapadmin.key`
- **PHPLDAPADMIN_HTTPS_CA_CRT_FILENAME**: Apache ssl CA certificate filename. Defaults to `ca.crt`

Ldap client TLS/LDAPS :

- **PHPLDAPADMIN_LDAP_CLIENT_TLS**: Enable ldap client tls config, ldap serveur certificate check and set client  certificate. Defaults to `true`
- **PHPLDAPADMIN_LDAP_CLIENT_TLS_REQCERT**: Set ldap.conf TLS_REQCERT. Defaults to `demand`
- **PHPLDAPADMIN_LDAP_CLIENT_TLS_CA_CRT_FILENAME**: Set ldap.conf TLS_CACERT to /container/service/ldap-client/assets/certs/$PHPLDAPADMIN_LDAP_CLIENT_TLS_CA_CRT_FILENAME. Defaults to `ldap-ca.crt`
- **PHPLDAPADMIN_LDAP_CLIENT_TLS_CRT_FILENAME**: Set .ldaprc TLS_CERT to /container/service/ldap-client/assets/certs/$PHPLDAPADMIN_LDAP_CLIENT_TLS_CRT_FILENAME. Defaults to `ldap-client.crt`
- **PHPLDAPADMIN_LDAP_CLIENT_TLS_KEY_FILENAME**: Set .ldaprc TLS_KEY to /container/service/ldap-client/assets/certs/$PHPLDAPADMIN_LDAP_CLIENT_TLS_KEY_FILENAME. Defaults to `ldap-client.key`

	More information at : http://www.openldap.org/doc/admin24/tls.html (16.2.2. Client Configuration)

### Set your own environment variables

#### Use command line argument
Environment variables can be set by adding the --env argument in the command line, for example:

	docker run --env PHPLDAPADMIN_LDAP_HOSTS="ldap.example.org" \
	--detach osixia/phpldapadmin:0.6.7

#### Link environment file

For example if your environment file is in :  /data/ldap/environment/my-env.yaml

	docker run --volume /data/ldap/environment/my-env.yaml:/container/environment/01-custom/env.yaml \
	--detach osixia/phpldapadmin:0.6.7

Take care to link your environment file to `/container/environment/XX-somedir` (with XX < 99 so they will be processed before default environment files) and not  directly to `/container/environment` because this directory contains predefined baseimage environment files to fix container environment (INITRD, LANG, LANGUAGE and LC_CTYPE).

#### Make your own image or extend this image

This is the best solution if you have a private registry. Please refer to the [Advanced User Guide](#advanced-user-guide) just below.

## Advanced User Guide

### Extend osixia/openldap:1.1.0 image

If you need to add your custom TLS certificate, bootstrap config or environment files the easiest way is to extends this image.

Dockerfile example:

    FROM osixia/phpldapadmin:0.6.7
    MAINTAINER Your Name <your@name.com>

    ADD https-certs /container/service/phpldapadmin/assets/apache2/certs
    ADD ldap-certs /container/service/ldap-client/assets/certs
    ADD environment /container/environment/01-custom


### Make your own phpLDAPadmin image

Clone this project :

	git clone https://github.com/osixia/docker-phpLDAPadmin
	cd docker-phpLDAPadmin

Adapt Makefile, set your image NAME and VERSION, for example :

	NAME = osixia/phpldapadmin
	VERSION = 0.6.7

	becomes :
	NAME = billy-the-king/phpldapadmin
	VERSION = 0.1.0

Add your custom certificate and environment files...

Build your image :

	make build

Run your image :

	docker run -d billy-the-king/phpldapadmin:0.1.0

### Tests

We use **Bats** (Bash Automated Testing System) to test this image:

> [https://github.com/sstephenson/bats](https://github.com/sstephenson/bats)

Install Bats, and in this project directory run :

	make test

### Kubernetes

Kubernetes is an open source system for managing containerized applications across multiple hosts, providing basic mechanisms for deployment, maintenance, and scaling of applications.

More information:
- http://kubernetes.io
- https://github.com/kubernetes/kubernetes

An osixia-phpldapadmin kubernetes example is available in **example/kubernetes**

### Under the hood: osixia/web-baseimage

This image is based on osixia/web-baseimage.
More info: https://github.com/osixia/docker-web-baseimage

## Changelog

Please refer to: [CHANGELOG.md](CHANGELOG.md)
