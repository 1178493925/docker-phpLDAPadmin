# osixia/phpldapadmin

A docker image to run phpLDAPadmin.
> [phpldapadmin.sourceforge.net](http://phpldapadmin.sourceforge.net)


## Quick start

Run a phpLDAPadmin docker image by replacing `ldap.example.com` with your ldap host or IP :

    sudo docker run -p 443:443 \
               -e LDAP_HOSTS=ldap.example.com \
               -d osixia/phpldapadmin

That's it :) you can access phpLDAPadmin on **https://localhost**


## Examples

### OpenLDAP & phpLDAPadmin in 1'

    # Run a ldap server, save the container id in LDAP_CID and get its IP:
    LDAP_CID=$(docker run -h ldap.example.org -d osixia/openldap:1.0.0)
    LDAP_IP=$(docker inspect -f "{{ .NetworkSettings.IPAddress }}" $LDAP_CID)

    # Run phpLDAPadmin and set ldap host
    PHPLDAP_CID=$(docker run -h phpldapadmin.example.org -e LDAP_HOSTS="ldap.example.org" -d osixia/phpldapadmin:0.6.0)

    # Because ldap.example.org is a fake hostname
    #Â we add a route to our ldap container in /etc/hosts
    docker exec $PHPLDAP_CID /sbin/add-host $LDAP_IP ldap.example.org

    # We get phpLDAPadmin container ip
    PHPLDAP_IP=$(docker inspect -f "{{ .NetworkSettings.IPAddress }}" $PHPLDAP_CID)

    echo "Go to: https://$PHPLDAP_IP"
    echo "Login DN: cn=admin,dc=example,dc=org"
    echo "Password: admin"

### HTTPS

#### Use autogenerated certificate
By default HTTPS is enable, a certificate is created with the container hostname (set by -h option eg: phpldapadmin.my-compagny.com).

	docker run -h phpldapadmin.my-compagny.com -d osixia/phpldapadmin

#### Use your own certificate

Add your custom certificate, private key and CA certificate in the directory **image/service/phpldapadmin/assets/apache2/ssl** adjust filename in **image/env.yaml** and rebuild the image ([see manual build](#manual-build)).

Or you can set your custom certificate at run time, by mouting your a directory containing thoses files to **/osixia/service/phpldapadmin/assets/apache2/ssl** and adjust there name with the following environment variables :

	docker run -v /path/to/certifates:/osixia/service/phpldapadmin/assets/apache2/ssl \
	-e SSL_CRT_FILENAME=my-phpldapadmin.crt \
	-e SSL_KEY_FILENAME=my-phpldapadmin.key \
	-e SSL_CA_CRT_FILENAME=the-ca.crt \
	-d osixia/phpldapadmin

Ommit the -e SSL_CA_CRT_FILENAME variable for self signed certificates

#### Disable HTTPS
Add -e HTTPS=false to the run command :

    docker run -e HTTPS=false -d osixia/phpldapadmin

## Environment Variables

## Manual build

Clone this project :

	git clone https://github.com/osixia/docker-phpLDAPadmin
	cd docker-phpLDAPadmin

Adapt Makefile, set your image NAME and VERSION, for example :

	NAME = osixia/phpldapadmin
	VERSION = 0.6.0

	becomes :
	NAME = billy-the-king/phpldapadmin
	VERSION = 0.1.0

Build your image :

	make build

Run your image :

	docker run -d billy-the-king/phpldapadmin:0.1.0

## Tests

We use **Bats** (Bash Automated Testing System) to test this image:

> [https://github.com/sstephenson/bats](https://github.com/sstephenson/bats)

Install Bats, and in this project directory run :

	make test
